



--CREACION DE UNIVERSO DE OPERACIONES 


use cob_cartera 
go 


--UNIVERSO DE OPERACIONES LISTA 1

if object_id ('dbo.operaciones_142443_1') is not null
	drop table dbo.operaciones_142443_1



create table operaciones_142443_1 (
id                    int identity ,
op_operacion          int, 
op_banco              varchar(12),
op_fecha_ult_proceso  datetime ,
op_oficina            int ,
op_cliente            int null,
op_procesado          char(1) null,
op_estado             int ,
op_moneda             int, 
op_toperacion         catalogo 
)


create unique nonclustered index ca_operacion_1
	on dbo.operaciones_142443_1 (id)


--UNIVERSO DE OPERACIONES LISTA 2

if object_id ('dbo.operaciones_142443_2') is not null
	drop table dbo.operaciones_142443_2
	
	
create table operaciones_142443_2 (
id                    	int  identity ,
op_operacion         	int, 
op_banco             	varchar(12),
op_fecha_ult_proceso 	datetime ,
op_oficina           	int ,
op_cliente              int null,
op_procesado            char(1) null,
op_estado               int,
op_moneda               int, 
op_toperacion           catalogo
)


create unique nonclustered index ca_operacion_1
	on dbo.operaciones_142443_2 (id)
	


--TABLA DE ERRORES 
if object_id ('dbo.errores_142443') is not null
	drop table dbo.errores_142443
	
	
create table errores_142443 (
id                    	int  identity ,
banco             	    varchar(12)  null ,
error                   int          null,
descripcion             varchar(500) null,
lista                   int          null
)

create unique nonclustered index errores_1
	on dbo.errores_142443 (id)



--
--LISTA 1:
--DEJAR CREDITO A 16 SEMANAS, MANTENIENDO EL DESPLAZAMIENTO
--APLICAR REESTRUCTURA PARA GENERACIÃ“N DE INTERESES EN ESPERA A 16 SEMANAS
--APLICAR CONDONACION
--APLICAR LOS PAGOS REALIZADOS POR EL GRUPO HASTA LA FECHA

select grupo = gr_grupo  
into #grupos_1
from cobis..cl_grupo where gr_grupo in 
(    
3    ,
9    ,
31   ,
34   ,
52   ,
53   ,
77   ,
97   ,
100  ,
101  ,
132  ,
173  ,
182  ,
192  ,
206  ,
212  ,
233  ,
236  ,
259  ,
299  ,
320  ,
323  ,
333  ,
341  ,
342  ,
357  ,
369  ,
379  ,
387  ,
423  ,
424  ,
428  ,
429  ,
470  ,
485  ,
487  ,
497  ,
498  ,
511  ,
521  ,
570  ,
578  ,
579  ,
585  ,
605  ,
624  ,
642  ,
659  ,
672  ,
701  ,
703  ,
715  ,
815  ,
827  ,
836  ,
931  ,
970  ,
985  ,
989  ,
997  ,
1003 ,
1016 ,
1032 ,
1049 ,
1050 ,
1068 ,
1092 ,
1103 ,
1112 ,
1115 ,
1148 ,
1161 ,
1190 ,
1200 ,
1217 ,
1236 ,
1246 ,
1253 ,
1255 ,
1263 ,
1285 ,
1292 ,
1315 ,
1348 ,
1364 ,
1372 ,
1399 ,
1408 ,
1437 ,
1439 ,
1452 ,
1463 ,
1464 ,
1466 ,
1544 ,
1551 ,
1556 ,
1558 ,
1576 ,
1577 ,
1585 ,
1588 ,
1589 ,
1659 ,
1666 ,
1678 ,
1725 ,
1759 ,
1812 ,
1820 ,
1824 ,
1843 ,
1913 ,
1957 ,
1963 ,
1986 ,
1998 ,
2024 ,
2033 ,
2045 ,
2074 ,
2087 ,
2088 ,
2089 ,
2100 ,
2138 ,
2139 ,
2142 ,
2171 ,
2212 ,
2217 ,
2222 ,
2226 ,
2230 ,
2235 ,
2244 ,
2292 ,
2309 ,
2344 ,
2345 ,
2357 ,
2362 ,
2374 ,
2377 ,
2427 ,
2458 ,
2478 ,
2529 ,
2531 ,
2534 ,
2583 ,
2602 ,
2606 ,
2625 ,
2642 ,
2678 ,
2694 ,
2712 ,
2723 ,
2728 ,
2747 ,
2769 ,
2777 ,
2794 ,
2800 ,
2803 ,
2866 ,
2921 ,
2935 ,
2949 ,
2971 ,
3028 ,
3035 ,
3062 ,
3078 ,
3115 ,
3180 ,
3234 ,
3275 ,
3324 ,
3337 ,
3352 ,
3367 ,
3388 ,
3396 ,
3401 ,
3419 ,
3422 ,
3424 ,
3427 ,
3442 ,
3455 ,
3474 ,
3479 ,
3485 ,
3517 ,
3519 ,
3525 ,
3534 ,
3543 ,
3565 ,
3590 ,
3591 ,
3618 ,
3630 ,
3665 ,
3669 ,
3670 ,
3677 ,
3687 ,
3741 ,
3774 ,
3780 ,
3788 ,
3794 ,
3795 ,
3831 ,
3850 ,
3854 ,
3869 ,
3872 ,
3882 ,
3920 ,
3949 ,
3963 ,
3970 ,
4077 ,
4083 ,
4085 ,
4089 ,
4111 ,
4122 ,
4134 ,
4145 ,
4186 ,
4189 ,
4237 ,
4261 ,
4269 ,
4272 ,
4274 ,
4278 ,
4286 ,
4296 ,
4300 ,
4314 ,
4333 ,
4348 ,
4362 ,
4400 ,
4402 ,
4407 ,
4428 ,
4462 ,
4503 ,
4508 ,
4518 ,
4523 ,
4532 ,
4567 ,
4600 ,
4601 ,
4613 ,
4622 ,
4627 ,
4630 ,
4658 ,
4700 ,
4704 ,
4706 ,
4707 ,
4783 ,
4790 ,
4847 ,
4866 ,
4881 ,
4906 ,
4930 ,
4947 ,
5008 ,
5040 ,
5051 ,
5068 ,
5099 ,
5110 ,
5125 ,
5145 ,
5167 ,
5171 ,
5173 ,
5175 ,
5227 ,
5269 ,
5270 ,
5271 ,
5275 ,
5278 ,
5279 ,
5280 ,
5295 ,
5297 ,
5306 ,
5309 ,
5319 ,
5337 ,
5365 ,
5372 ,
5414 ,
5448 ,
5453 ,
5460 ,
5468 ,
5485 ,
5488 ,
5503 ,
5507 ,
5521 ,
5524 ,
5530 ,
5538 ,
5555 ,
5582 ,
5599 ,
5604 ,
5613 ,
5614 ,
5616 ,
5625 ,
5646 ,
5647 ,
5660 ,
5680 ,
5710 ,
5714 ,
5724 ,
5728 ,
5743 ,
5779 ,
5782 ,
5825 ,
5849 ,
5850 ,
5855 ,
5857 ,
5871 ,
5887 ,
5895 ,
5906 ,
5914 ,
5934 ,
5950 ,
5990 ,
5999 ,
6019 ,
6040 ,
6041 ,
6046 ,
6047 ,
6059 ,
6066 ,
6084 ,
6121 ,
6140 ,
6179 ,
6196 ,
6197 ,
6204 ,
6224 ,
6253 ,
6288 ,
6317 ,
6318 ,
6320 ,
6336 ,
6348 ,
6352 ,
6401 ,
6412 ,
6426 ,
6438 ,
6444 ,
6465 ,
6486 ,
6492 ,
6493 ,
6496 ,
6513 ,
6519 ,
6542 ,
6556 ,
6580 ,
6602 ,
6604 ,
6605 ,
6613 ,
6619 ,
6624 ,
6628 ,
6660 ,
6668 ,
6676 ,
6680 ,
6701 ,
6722 ,
6758 ,
6765 ,
6785 ,
6801 ,
6841 ,
6853 ,
6860 ,
6897 ,
6917 ,
6931 ,
6933 ,
6951 ,
6955 ,
6974 ,
7018 ,
7025 ,
7065 ,
7071 ,
7073 ,
7083 ,
7086 ,
7097 ,
7129 ,
7132 ,
7142 ,
7147 ,
7172 ,
7208 ,
7238 ,
7247 ,
7267 ,
7301 ,
7372 ,
7389 ,
7441 ,
7473 ,
7526 ,
7557 ,
7605 ,
7689 ,
7733 ,
7735 ,
7823 ,
7825 ,
7826 ,
7903 ,
7918 ,
7943 ,
7945 ,
7958 ,
7994 ,
8001 ,
8021 ,
8037 ,
8064 ,
8074 ,
8106 ,
8107 ,
8116 ,
8148 ,
8172 ,
8188 ,
8211 ,
8216 ,
8238 ,
8246 ,
8272 ,
8273 ,
8275 ,
8298 ,
8318 ,
8324 ,
8358 ,
8368 ,
8408 ,
8453 ,
8454 ,
8468 ,
8490 ,
8495 ,
8504 ,
8516 ,
8520 ,
8522 ,
8533 ,
8535 ,
8540 ,
8551 ,
8559 ,
8571 ,
8573 ,
8579 ,
8586 ,
8591 ,
8614 ,
8619 ,
8626 ,
8635 ,
8701 ,
8708 ,
8714 ,
8732 ,
8737 ,
8738 ,
8746 ,
8749 ,
8766 ,
8768 ,
8773 ,
8776 ,
8792 ,
8795 ,
8797 ,
8798 ,
8803 ,
8812 ,
8820 ,
8826 ,
8839 ,
8840 ,
8859 ,
8860 ,
8861 ,
8865 ,
8893 ,
8916 ,
8917 ,
8920 ,
8926 ,
8932 ,
8935 ,
8955 ,
8972 ,
8973 ,
8976 ,
8977 ,
8992 ,
9007 ,
9010 ,
9022 ,
9026 ,
9046 ,
9063 ,
9065 ,
9067 ,
9072 ,
9087 ,
9089 ,
9125 ,
9129 ,
9134 ,
9145 ,
9147 ,
9151 ,
9160 ,
9175 ,
9181 ,
9187 ,
9194 ,
9200 ,
9211 ,
9219 ,
9230 ,
9242 ,
9243 ,
9244 ,
9245 ,
9253 ,
9257 ,
9272 ,
9287 ,
9297 ,
9298 ,
9300 ,
9305 ,
9309 ,
9315 ,
9316 ,
9324 ,
9331 ,
9332 ,
9334 ,
9354 ,
9357 ,
9361 ,
9365 ,
9374 ,
9399 ,
9407 ,
9415 ,
9437 ,
9438 ,
9440 ,
9465 ,
9485 ,
9490 ,
9503 ,
9507 ,
9516 ,
9521 ,
9523 ,
9528 ,
9532 ,
9549 ,
9550 ,
9564 ,
9569 ,
9572 ,
9590 ,
9592 ,
9597 ,
9601 ,
9603 ,
9605 ,
9607 ,
9620 ,
9624 ,
9640 ,
9646 ,
9656 ,
9660 ,
9664 ,
9667 ,
9668 ,
9678 ,
9682 ,
9700 ,
9707 ,
9714 ,
9721 ,
9723 ,
9738 ,
9752 ,
9756 ,
9766 ,
9767 ,
9769 ,
9771 ,
9778 ,
9781 ,
9795 ,
9798 ,
9802 ,
9808 ,
9813 ,
9823 ,
9833 ,
9858 ,
9864 ,
9870 ,
9872 ,
9874 ,
9876 ,
9882 ,
9892 ,
9902 ,
9914 ,
9915 ,
9917 ,
9918 ,
9921 ,
9922 ,
9932 ,
9941 ,
9945 ,
9948 ,
9950 ,
9955 ,
9958 ,
9972 ,
9974 ,
9993 ,
10001,
10003,
10006,
10008,
10012,
10016,
10022,
10025,
10030,
10032,
10033,
10037,
10050,
10057,
10058,
10059,
10061,
10066,
10077,
10078,
10090,
10094,
10105,
10127,
10142,
10165,
10170,
10173,
10183,
10189,
10213,
10215,
10224,
10234,
10244,
10247,
10257,
10263,
10268,
10269,
10271,
10279,
10281,
10290,
10299,
10333,
10374,
10392,
10395,
10396,
10406,
10421,
10433,
10445,
10453,
10463,
10464,
10475,
10488,
10494,
10498,
10500,
10502,
10503,
10504,
10506,
10512,
10522,
10525,
10527,
10545,
10553,
10559,
10565,
10572,
10579,
10584,
10590,
10604,
10613,
10630,
10631,
10641,
10646,
10647,
10648,
10654,
10683,
10685,
10709,
10725,
10728,
10732,
10734,
10744,
10746,
10750,
10752,
10753,
10763,
10781,
10782,
10805,
10812,
10821,
10828,
10832,
10839,
10840,
10841,
10842,
10858,
10883,
10915,
10931,
10948,
10961,
10966,
10968,
10974,
10975,
10977,
10980,
10987,
10993,
11011,
11027,
11030,
11031,
11045,
11049,
11082,
11087,
11089,
11095,
11098,
11110,
11112,
11120,
11121,
11139,
11144,
11154,
11171,
11173,
11181,
11182,
11189,
11196,
11200,
11215,
11219,
11227,
11234,
11237,
11260,
11278,
11294,
11304,
11331,
11342,
11348,
11352,
11363,
11368,
11383,
11387,
11403,
11422,
11440,
11464,
11480,
11493,
11513,
11555,
11587,
11662,
11665,
11671,
11672,
11679,
11703,
11749,
11756,
11770,
11787,
11819,
11850,
11870,
11882,
11895,
11907,
11911,
11912,
11935,
11946,
11951,
11955,
11957,
11986,
11996,
12021,
12050,
12053,
12056,
12063,
12064,
12066,
12090,
12129,
12159,
12178,
12186,
12192,
12199,
12203,
12215,
12254,
12292,
12307,
12312,
12318,
12320,
12329,
12343,
12364,
12366,
12374,
12383,
12398,
12404,
12410,
12424,
12435,
12436,
12442,
12445,
12450,
12454,
12459,
12460,
12465,
12477,
12480,
12490,
12491,
12521,
12534,
12543,
12544,
12563,
12565,
12589,
12597,
12611,
12621,
12627,
12634,
12638,
12647,
12654,
12670,
12672,
12673,
12706,
12712,
12719,
12737,
12754,
12760,
12775,
12781,
12787,
12788,
12790,
12808,
12815,
12845,
12851,
12872,
12878,
12882,
12890,
12891,
12911,
12917,
12923,
12937,
12941,
12942,
12944,
12952,
12969,
12976,
12986,
12990,
12993,
12994,
12999,
13009,
13020,
13032,
13033,
13039,
13066,
13070,
13071,
13074,
13075,
13076,
13111,
13114,
13128,
13129,
13132,
13135,
13147,
13150,
13151,
13158,
13160,
13165,
13166,
13167,
13170,
13175,
13192,
13198,
13204,
13208,
13209,
13212,
13217,
13220,
13226,
13230,
13233,
13240,
13241,
13243,
13244,
13249,
13250,
13253,
13260,
13264,
13265,
13267,
13277,
13281,
13283,
13285,
13288,
13289,
13293,
13298,
13311,
13319,
13333,
13337,
13345,
13353,
13355,
13357,
13367,
13372,
13377,
13379,
13384,
13385,
13387,
13392,
13398,
13400,
13406,
13412,
13418,
13425,
13426,
13428,
13429,
13432,
13435,
13438,
13440,
13446,
13450,
13453,
13463,
13465,
13469,
13472,
13489,
13496,
13502,
13507,
13513,
13514,
13515,
13520,
13528,
13530,
13531,
13534,
13535,
13536,
13540,
13542,
13548,
13554,
13558,
13559,
13560,
13561,
13570,
13574,
13580,
13589,
13597,
13599,
13602,
13607,
13612,
13615,
13616,
13618,
13621,
13628,
13630,
13639,
13643,
13658,
13660,
13666,
13672,
13673,
13676,
13681,
13693,
13696,
13697,
13701,
13706,
13707,
13710,
13716,
13719,
13741,
13743,
13745,
13749,
13749,
13767,
13775,
13781,
13789,
13793,
13795,
13796,
13800,
13809,
13812,
13815,
13822,
13823,
13825,
13827,
13829,
13835,
13844,
13845,
13849,
13850,
13854,
13864,
13872,
13877,
13878,
13879,
13880,
13885,
13890,
13892,
13895,
13896,
13903,
13904,
13906,
13908,
13910,
13911,
13914,
13921,
13923,
13925,
13926,
13931,
13941,
13945,
13955,
13956,
13961,
13963,
13966,
13968,
13969,
13972,
13977,
13979,
13981,
13985,
13991,
13993,
13995,
14005,
14006,
14008,
14010,
14011,
14012,
14014,
14015,
14025,
14030,
14044,
14045,
14055,
14059,
14060,
14062,
14064,
14072,
14075,
14077,
14081,
14084,
14085,
14086,
14096,
14097,
14103,
14107,
14110,
14111,
14116,
14122,
14124,
14125,
14127,
14132,
14133,
14134,
14135,
14136,
14137,
14142,
14146,
14149,
14154,
14158,
14161,
14165,
14167,
14173,
14180,
14181,
14189,
14192,
14193,
14194,
14198,
14199,
14201,
14205,
14219,
14222,
14223,
14225,
14231,
14232,
14234,
14235,
14238,
14239,
14250,
14251,
14252,
14255,
14269,
14295,
14298,
14299,
14306,
14317,
14318,
14321,
14325,
14334,
14335,
14336,
14339,
14344,
14350,
14351,
14353,
14356,
14358,
14378,
14387,
14389,
14391,
14392,
14393,
14394,
14401,
14403,
14409,
14410,
14412,
14419,
14428,
14429,
14431,
14433,
14441,
14446,
14448,
14455,
14464,
14468,
14472,
14473,
14478,
14480,
14482,
14489,
14490,
14491,
14494,
14497,
14504,
14511,
14514,
14516,
14521,
14523,
14532,
14533,
14546,
14548,
14551,
14553,
14559,
14561,
14563,
14568,
14569,
14571,
14575,
14577,
14578,
14584,
14617,
14626,
14629,
14630,
14634,
14646,
14647,
14649,
14652,
14656,
14658,
14664,
14670,
14673,
14676,
14677,
14682,
14688,
14697,
14702,
14704,
14708,
14710,
14711,
14712,
14718,
14722,
14730,
14745,
14752,
14754,
14762,
14763,
14764,
14770,
14773,
14776,
14781,
14785,
14795,
14810,
14817,
14818,
14824,
14833,
14839,
14842,
14845,
14848,
14866,
14881,
14885,
14886,
14887,
14889,
14894,
14901,
14905,
14922,
14923,
14924,
14927,
14931,
14944,
14946,
14948,
14952,
14955,
14956,
14958,
14966,
14978,
14989,
14991,
14997,
15005,
15006,
15008,
15015,
15025,
15037,
15048,
15050,
15063,
15067,
15079,
15087,
15088,
15095,
15097,
15099,
15105,
15108,
15132,
15133,
15139,
15140,
15141,
15149,
15150,
15152,
15156,
15158,
15162,
15167,
15168,
15169,
15172,
15175,
15183,
15184,
15192,
15198,
15202,
15209,
15217,
15221,
15224,
15232,
15235,
15241,
15242,
15245,
15254,
15262,
15270,
15271,
15276,
15277,
15284,
15286,
15295,
15297,
15304,
15310,
15315,
15317,
15320,
15326,
15330,
15344,
15364,
15366,
15414,
15417,
15484,
15491,
16376
)


--LISTA 3:
--DEJAR CREDITO A 16 SEMANAS, MANTENIENDO EL DESPLAZAMIENTO
--APLICAR LOS PAGOS REALIZADOS POR EL GRUPO HASTA LA FECHA


select grupo = gr_grupo  
into #grupos_2
from cobis..cl_grupo where gr_grupo in 
(
86   ,
117  ,
363  ,
478  ,
626  ,
638  ,
710  ,
898  ,
1052 ,
1231 ,
1232 ,
1482 ,
1632 ,
1726 ,
1738 ,
1950 ,
2124 ,
2202 ,
2223 ,
2390 ,
2440 ,
2449 ,
2473 ,
2488 ,
2493 ,
2495 ,
2567 ,
2623 ,
2665 ,
2808 ,
2846 ,
2894 ,
2895 ,
2899 ,
2968 ,
3003 ,
3009 ,
3021 ,
3048 ,
3257 ,
3295 ,
3497 ,
3552 ,
3613 ,
3645 ,
3663 ,
3698 ,
3712 ,
3715 ,
3748 ,
3798 ,
3803 ,
3806 ,
3832 ,
3862 ,
3877 ,
3967 ,
3988 ,
4178 ,
4250 ,
4254 ,
4255 ,
4268 ,
4339 ,
4389 ,
4409 ,
4464 ,
4469 ,
4482 ,
4513 ,
4544 ,
4569 ,
4571 ,
4580 ,
4610 ,
4634 ,
4665 ,
4730 ,
4743 ,
4762 ,
4838 ,
4854 ,
4961 ,
4972 ,
4992 ,
5005 ,
5101 ,
5174 ,
5292 ,
5634 ,
5636 ,
5746 ,
5763 ,
5792 ,
5866 ,
5876 ,
5920 ,
5933 ,
5965 ,
6056 ,
6109 ,
6111 ,
6112 ,
6125 ,
6319 ,
6387 ,
6409 ,
6453 ,
6468 ,
6491 ,
6532 ,
6558 ,
6568 ,
6597 ,
6618 ,
6627 ,
6672 ,
6675 ,
6704 ,
6770 ,
6776 ,
6814 ,
6823 ,
6914 ,
6922 ,
6924 ,
6947 ,
6962 ,
6967 ,
7002 ,
7017 ,
7040 ,
7075 ,
7088 ,
7094 ,
7163 ,
7182 ,
7217 ,
7260 ,
7268 ,
7277 ,
7278 ,
7289 ,
7303 ,
7317 ,
7370 ,
7428 ,
7469 ,
7536 ,
7540 ,
7541 ,
7571 ,
7596 ,
7665 ,
7793 ,
7807 ,
7898 ,
7987 ,
8016 ,
8107 ,
8321 ,
8458 ,
8613 ,
8652 ,
8669 ,
8684 ,
8688 ,
8841 ,
8881 ,
8905 ,
8974 ,
8978 ,
9024 ,
9025 ,
9027 ,
9033 ,
9096 ,
9365 ,
9427 ,
9444 ,
9482 ,
9508 ,
9551 ,
9573 ,
9574 ,
9577 ,
9598 ,
9758 ,
9850 ,
9873 ,
9883 ,
9982 ,
10081,
10103,
10125,
10135,
10136,
10139,
10144,
10186,
10272,
10307,
10315,
10325,
10335,
10362,
10363,
10380,
10398,
10438,
10455,
10460,
10484,
10517,
10529,
10532,
10534,
10550,
10554,
10555,
10557,
10574,
10582,
10591,
10598,
10628,
10634,
10660,
10667,
10705,
10723,
10731,
10737,
10757,
10803,
10806,
10815,
10834,
10867,
10886,
10893,
10910,
10926,
10927,
10950,
10954,
10958,
10985,
10989,
11007,
11020,
11066,
11099,
11109,
11128,
11135,
11148,
11152,
11155,
11176,
11179,
11189,
11214,
11220,
11250,
11269,
11273,
11303,
11306,
11326,
11332,
11342,
11344,
11354,
11366,
11367,
11370,
11408,
11419,
11444,
11473,
11619,
11623,
11853,
11916,
11933,
11961,
12117,
12239,
12328,
12350,
12617,
12628,
12690,
12800,
12849,
12910,
12960,
12973,
12973,
12991,
13056,
13057,
13068,
13102,
13130,
13256,
13270,
13284,
13292,
13350,
13405,
13421,
13484,
13550,
13619,
13622,
13683,
13697,
13721,
13749,
13754,
13794,
13811,
13818,
13837,
13888,
14062,
14068,
14089,
14108,
14162,
14168,
14200,
14247,
14320,
14331,
14380,
14395,
14512,
14530,
14549,
14555,
14580,
14601,
14606,
14627,
14638,
14662,
14687,
14705,
14716,
14723,
14740,
14746,
14769,
14796,
14804,
14805,
14847,
14884,
14930,
14937,
14974,
14976,
14988,
14994,
15003,
15010,
15013,
15014,
15021,
15023,
15035,
15039,
15044,
15056,
15059,
15072,
15077,
15080,
15085,
15113,
15119,
15126,
15129,
15132,
15138,
15154,
15160,
15173,
15179,
15189,
15193,
15199,
15203,
15263,
15274,
15280,
15285,
15287,
15288,
15293,
15294,
15299,
15313,
15329,
15335,
15347,
15351,
15353,
15365,
15368,
15370,
15373,
15380,
15381,
15382,
15388,
15398,
15405,
15409,
15410,
15415,
15424,
15437,
15438)


/*OBTENEMOS LAS OPERACIONES DEL CICLO  GRUPO LISTA 1*/
select 	* into #ca_det_ciclo_1 from ca_det_ciclo
where dc_grupo in (select grupo from #grupos_1)

--OBTENEMOS LAS OPERACIONES CON DESPLAZAMIENTO
select * into #operaciones_1 from #ca_det_ciclo_1
where dc_operacion in (select de_operacion from ca_desplazamiento where de_estado = 'A' and de_archivo <> 'WORKFLOW')

insert into  operaciones_142443_1 (op_operacion,op_banco,op_fecha_ult_proceso,op_oficina)
select distinct dc_operacion , '','',0
from #operaciones_1

--CARGA DE LISTADO DE OPERACIONES EN TABLAS DE TRABAJO
update operaciones_142443_1 set 
op_banco                = a.op_banco ,
op_fecha_ult_proceso    = a.op_fecha_ult_proceso,
op_oficina              = a.op_oficina,
op_cliente              = a.op_cliente,
op_estado               = a.op_estado ,
op_moneda               = a.op_moneda,
op_toperacion           = a.op_toperacion
from ca_operacion a ,operaciones_142443_1 b
where a.op_operacion = b.op_operacion 
 



/*OBTENEMOS LAS OPERACIONES DEL CICLO  GRUPO LISTA 2*/
select 	* into #ca_det_ciclo_2 from ca_det_ciclo
where dc_grupo in (select grupo from #grupos_2)

--OBTENEMOS LAS OPERACIONES CON DESPLAZAMIENTO
select * into #operaciones_2 from #ca_det_ciclo_2
where dc_operacion in (select de_operacion from ca_desplazamiento where de_estado = 'A' and de_archivo <> 'WORKFLOW')

insert into  operaciones_142443_2 (op_operacion,op_banco,op_fecha_ult_proceso,op_oficina)
select distinct dc_operacion , '','',0
from #operaciones_2

--CARGA DE LISTADO DE OPERACIONES EN TABLAS DE TRABAJO
update operaciones_142443_2 set 
op_banco                = a.op_banco ,
op_fecha_ult_proceso    = a.op_fecha_ult_proceso,
op_oficina              = a.op_oficina,
op_cliente              = a.op_cliente,
op_estado               = a.op_estado,
op_moneda               = a.op_moneda,
op_toperacion           = a.op_toperacion 
from ca_operacion a ,operaciones_142443_2 b
where a.op_operacion = b.op_operacion 
 
 
 
 
delete operaciones_142443_1 where op_estado = 3 

delete operaciones_142443_2 where op_estado = 3 


 
select 'OPERACIONES LISTA 1 ', count(*) from operaciones_142443_1
select 'OPERACIONES LISTA 2 ', count(*)from operaciones_142443_2



drop table #grupos_1
drop table #ca_det_ciclo_1 
drop table #operaciones_1


drop table #grupos_2
drop table #ca_det_ciclo_2
drop table #operaciones_2
